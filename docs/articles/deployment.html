<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="singlecellviz">
<title>Deployment • singlecellviz</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deployment">
<meta property="og:description" content="singlecellviz">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">singlecellviz</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/usage.html">Usage</a>
    <a class="dropdown-item" href="../articles/database.html">Database</a>
    <a class="dropdown-item" href="../articles/development.html">Development</a>
    <a class="dropdown-item" href="../articles/deployment.html">Deployment</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/metzger-chambon/singlecellviz/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Deployment</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metzger-chambon/singlecellviz/blob/HEAD/vignettes/deployment.Rmd" class="external-link"><code>vignettes/deployment.Rmd</code></a></small>
      <div class="d-none name"><code>deployment.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The following gives some insights on how to deploy the app on a local
machine.</p>
<p>To deploy the app, you should have access to the local machine with
<strong>sudo rights</strong> (“superuser do”, i.e. allows a permitted
user to execute a command as the superuser). Refer to a person in charge
for the name of the machine and/or the IT department to have the sudo
rights.</p>
<p>You need to connect to the server with by running the following in a
bash Terminal:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">ssh</span> yourusername@server-adress</span></code></pre></div>
<p>When working on the machine, if you run a command that require
specific rights, you will have to add <code>sudo</code> just before the
command, and it will ask you for your password before allowing you to
run the command.</p>
<p><strong>Everything that the app uses needs to be on the server
(datasets, R packages, scripts…).</strong></p>
</div>
<div class="section level2">
<h2 id="characteristics-of-the-server">Characteristics of the server<a class="anchor" aria-label="anchor" href="#characteristics-of-the-server"></a>
</h2>
<p>The server machine is under Debian 12. It has:</p>
<ul>
<li>8Go of hard disk</li>
<li>4Go of RAM</li>
<li>1 vCPU</li>
</ul>
</div>
<div class="section level2">
<h2 id="shiny-server">Shiny Server<a class="anchor" aria-label="anchor" href="#shiny-server"></a>
</h2>
<p>To learn about how to host and manage an app with Shiny Server, check
out their documentation: <a href="https://docs.posit.co/shiny-server/" class="external-link uri">https://docs.posit.co/shiny-server/</a>.</p>
<p>Notably you can:</p>
<ul>
<li>start/stop/restart the server manually with
<code>sudo systemctl start shiny-server</code>/<code>sudo systemctl stop shiny-server</code>/<code>sudo systemctl restart shiny-server</code>
</li>
<li>check the status of the shiny-server with
<code>sudo systemctl status shiny-server</code>
</li>
<li>reload configuration of the server without interruption with
<code>sudo systemctl reload shiny-server</code>
</li>
<li>change the <strong>configuration file</strong>
<code>shiny-server.conf</code> to host various apps within the same
server, redirect to another locations etc…</li>
</ul>
</div>
<div class="section level2">
<h2 id="deploy-a-new-version-of-the-app">Deploy a new version of the app<a class="anchor" aria-label="anchor" href="#deploy-a-new-version-of-the-app"></a>
</h2>
<p>In practice, here is how to update the app.</p>
<div class="section level3">
<h3 id="update-the-app-via-git">Update the app via git<a class="anchor" aria-label="anchor" href="#update-the-app-via-git"></a>
</h3>
<p>The development of the app can be done locally. Once a stable version
is available, it should be pushed to the github repository
(<code>git push</code>).</p>
<p>This version can then be retrieved from the server by running
<code>git pull</code>. All the tracked files will be updated
(e.g. scripts under <code>R/</code>, <code>renv.lock</code>…).</p>
</div>
<div class="section level3">
<h3 id="update-datasets-via-scp">Update datasets via scp<a class="anchor" aria-label="anchor" href="#update-datasets-via-scp"></a>
</h3>
<p>Heavy files should not be tracked with git. It is the case of
datasets. Everything under <code>db/</code> has to be updated/added
manually by using the command <code>scp</code>.</p>
<p>To correctly add a dataset to the app it needs to both:</p>
<ul>
<li>have a row in the file <code>dataset_summary.txt</code>, which
notably states its name and location in <code>db/</code>
</li>
<li>have the dataset present under the said location in
<code>db/</code>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="update-the-r-packages-via-renv">Update the R packages via renv<a class="anchor" aria-label="anchor" href="#update-the-r-packages-via-renv"></a>
</h3>
<p>If some packages have been locally installed/updated, the new
(versions) of R packages should be tracked by running
<code><a href="https://rstudio.github.io/renv/reference/snapshot.html" class="external-link">renv::snapshot()</a></code>, and saving the updated
<code>renv.lock</code> in git.</p>
<p>Once <code>git pull</code> has been run on the server, the
<code>renv.lock</code> file is updated, but the new (versions) of the R
packages are not yet downloaded on the server. Indeed,
<code><a href="https://rstudio.github.io/renv/reference/restore.html" class="external-link">renv::restore()</a></code> needs to be run successfully to install the
new packages.</p>
</div>
<div class="section level3">
<h3 id="update-the-cache">Update the cache<a class="anchor" aria-label="anchor" href="#update-the-cache"></a>
</h3>
<p>The app makes use of the cache. When an update has been made, the
previously created cache must be removed in order to prevent old results
to appear.</p>
<p>To do that, run in the server
<code>rm -r singlecellviz/cache/*.rds</code>. The first time you open
the app and test out that it works with the new datasets, it might take
some time as it will ask the database for some data, and save the data
as <code>.rds</code> in the cache file. If you re-try, it should be
faster as the data is saved in the cache!</p>
</div>
</div>
<div class="section level2">
<h2 id="important-locations">Important locations<a class="anchor" aria-label="anchor" href="#important-locations"></a>
</h2>
<p>The location of the important paths are listed in the
<code>README.txt</code> of the <code>/srv/shiny-server/</code>
directory.</p>
<p>For example, you can find the location of:</p>
<ul>
<li>the packages relative to shiny</li>
<li>the packages relative to the app</li>
<li>temp files</li>
<li>cache files</li>
<li>server config</li>
<li>…</li>
</ul>
</div>
<div class="section level2">
<h2 id="important-commands">Important commands<a class="anchor" aria-label="anchor" href="#important-commands"></a>
</h2>
<p>This assumes that you know the basics of bash (<code>cd</code>,
<code>ls</code>, <code>cp</code>, <code>mv</code>, <code>mkdir</code>,
<code>rm</code>, <code>cat</code>, <code>grep</code>…), and how to
navigate through the paths. But these are some commands line that you
might not be familiar with, and that are quite useful when working on
the machine.</p>
<div class="section level3">
<h3 id="general">General<a class="anchor" aria-label="anchor" href="#general"></a>
</h3>
<ul>
<li>
<code>sudo -i</code> act like <strong>sudo interactively</strong>,
you won’t have to add <code>sudo</code> before every command, but be
very careful with what you do, with greats powers comes great
responsibility, and you will have the rights to modify and delete very
important files without warning! To come back to your normal user
rights, run <code>exit</code>.</li>
<li>
<code>history</code> output the history of bash commands run by the
user</li>
</ul>
</div>
<div class="section level3">
<h3 id="file-handling">File handling<a class="anchor" aria-label="anchor" href="#file-handling"></a>
</h3>
<ul>
<li>
<code>chmod</code> change the <strong>reading / writing / executing
rights</strong> of a file or folder (be careful about giving enough
rights to the cache folder for example!).</li>
<li>
<code>chown</code> change the <strong>owner</strong> of a file or
folder.</li>
<li>
<code>ln -s</code> create <strong>symbolic link</strong>, in order
to point to a file/folder that already exists somewhere in the server,
without having to copy it (~ shortcut).</li>
<li>
<code>scp</code> copy a file or folder from one location to another
(e.g. <strong>copy a dataset from hpc server to this shiny
server!</strong>)</li>
</ul>
</div>
<div class="section level3">
<h3 id="space-usage">Space usage<a class="anchor" aria-label="anchor" href="#space-usage"></a>
</h3>
<ul>
<li>
<code>df -h</code> output the hard disk space used by every
partitions</li>
<li>
<code>du -sh</code> output the hard disk space used of
files/directories</li>
</ul>
</div>
<div class="section level3">
<h3 id="server-processes">Server processes<a class="anchor" aria-label="anchor" href="#server-processes"></a>
</h3>
<ul>
<li>
<code>watch -d free -m</code> observe periodically (every 2.0
seconds) the <strong>memory and swap usage</strong> of the server</li>
<li>
<code>ps aux</code> report a snapshot of the current processes</li>
<li>
<code>kill</code> stop a process (you can use the PID shown in
<code>ps aux</code>)</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Valentine Gilbart.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
